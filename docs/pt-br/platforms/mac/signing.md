---
summary: "Signing steps for macOS debug builds generated by packaging scripts"
read_when:
  - Building or signing mac debug builds
---

# assinatura do mac (compilações de depuração)

Esta aplicação é normalmente construída a partir de [<<<CODE0>>](<<LINK0>>>>), que agora:

- define um identificador de pacote de depuração estável: <<CODE0>>
- escreve o Info.plist com esse id do pacote (sobrepor via <<CODE1>>)
- chama [<<<CODE2>>](<<LINK0>>>) para assinar o pacote principal binário e aplicativo, de modo que macOS trata cada reconstrução como o mesmo pacote assinado e mantém permissões TCC (notificações, acessibilidade, gravação de tela, microfone, fala). Para permissões estáveis, use uma identidade assinante real; ad-hoc é opt-in e frágil (veja [macOS permissions](<<LINK1>>)).
- usa <<CODE3> por padrão; ele permite datas confiáveis para assinaturas de ID do desenvolvedor. Defina <<CODE4> para pular o timestamping (compilações de depuração offline).
- injectar metadados na Info. plist: <<CODE5>> (UTC) e <<CODE6>> (hash curto) assim que o painel Sobre pode mostrar build, git, e canal de depuração/lançamento.
- **Pacote requer Node 22+**: o script executa builds de TS e a compilação de UI de Controle.
- lê- se <<CODE7>> do ambiente. Adicione <<CODE8>> (ou seu certificado de Aplicação de ID do desenvolvedor) ao seu shell rc para sempre assinar com seu certificado. A assinatura ad hoc requer opt-in explícito via <<CODE9>> ou <<CODE10>> (não recomendado para testes de permissão).
- executa uma auditoria de identificação de equipe após a assinatura e falha se qualquer Mach-O dentro do pacote de aplicativos é assinado por um ID de equipe diferente. Definir <<CODE11>> para desvio.

Utilização

```bash
# from repo root
scripts/package-mac-app.sh               # auto-selects identity; errors if none found
SIGN_IDENTITY="Developer ID Application: Your Name" scripts/package-mac-app.sh   # real cert
ALLOW_ADHOC_SIGNING=1 scripts/package-mac-app.sh    # ad-hoc (permissions will not stick)
SIGN_IDENTITY="-" scripts/package-mac-app.sh        # explicit ad-hoc (same caveat)
DISABLE_LIBRARY_VALIDATION=1 scripts/package-mac-app.sh   # dev-only Sparkle Team ID mismatch workaround
```

Nota de Assinatura Ad hoc

Ao assinar com <<CODE0> (ad-hoc), o script desativa automaticamente o **Hardened Runtime** (<<CODE1>>). Isso é necessário para evitar falhas quando o aplicativo tenta carregar frameworks incorporados (como Sparkle) que não compartilham o mesmo ID de equipe. As assinaturas ad-hoc também quebram a persistência da permissão do TCC; veja [permissões macOS](<<LINK0>>>) para as etapas de recuperação.

# # Construir metadados para Sobre

<<CODE0> carimba o pacote com:

- <<CODE0>>: ISO8601 UTC na hora do pacote
- <<CODE1>>: haxixe git curto (ou <<CODE2> se não estiver disponível)

A aba Sobre lê estas chaves para mostrar a versão, data de compilação, git commit, e se é uma compilação de depuração (via <<CODE0>>). Execute o empacotador para atualizar esses valores após as alterações de código.

# # Porque

As permissões TCC estão ligadas ao identificador do pacote  and  code signature. Compilações de depuração sem assinatura com UUIDs mudando estavam fazendo com que o macOS esquecesse as subvenções após cada reconstrução. Assinar os binários (ad-hoc por padrão) e manter um id/caminho fixo do pacote (<<CODE0>>>) preserva os subsídios entre builds, correspondendo à abordagem VibeTunnel.
